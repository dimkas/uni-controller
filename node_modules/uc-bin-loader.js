'use strict';

const os = require('os');
const fs = require('fs');

module.exports = function(mod, bin) {
    let dirname = require('path').dirname(mod.filename);

    let binDir = `${os.arch()}.${os.platform()}.${process.version.split('.')[0]}`

    let file = `${binDir}/${bin}.node.js`;
    for(let i = 0; i < 2; i++){
        if (fs.existsSync(`${dirname}/${file}`)) {
            let res = require(`${dirname}/${file}`);
            console.info(`Load ./${file}`)
            return res;
        };
        file = `${binDir}/${bin}.node`;
    }
    throw(`File not found: ${file}`);
}